entities:
  seaf.ta.services.k8s_dzo:
    title: Расширение описание кластера K8s для целей проверки станадртов
    objects:
      k8s_dzo:
        route: "/"
        title: Расширение описание кластера K8s для целей проверки станадртов
    schema: # JSON Schema контролирующая описание объекта сущности
      type: object
      patternProperties:
        "[a-zA-Z0-9_\\.]*":
          $ref: "#/$defs/seaf.ta.services.k8s"
          properties:
            #Часть 3. TACIR_1-КП-КО-3-01. Платформа контейнерной оркестрации должна иметь в резервных зонах доступности кластер/кластеры обеспечивающие 100% производительности платформы при потере основной зоны.
            reservation_rate:
              title: Процент резервирования вычислительных ресурсов кластера в другой зоне доступности
              type: integer
            #Часть 3. TACIR_1-КП-КО-4-01.
            az_used:
              title: Количество зон доступности в которых развёрнут кластер K8s
              type: integer
            #Часть 3. TACIR_1-КП-КБ-2-01.
            ntp_server:
              title: Адрес NTP сервера с которым синхронизируются все ноды кластера
              type: string
            #Часть 3. TACIR_1-КП-КБ-8-01.
            tls_version:
              title: Версия TLS сертификатов кластера (kubeapi, etc...).
              type: string
            #Часть 3. TACIR_1-КП-КБ-16-01
            anonymous_api_connect:
              title: Анонимное подключение к kubeapi включено
              type: boolean
            #Часть 3. TACIR_1-КП-КБ-18-01.
            https_api_connect:
              title: HTTPS подключение к kubeapi включено
              type: boolean
            #Часть 3. TACIR_1-КП-КБ-29-01.
            pv:
              title: Persistent Volume используются в кластере K8s
              type: boolean
            virtual_cluster_id:
              title: Связь K8s кластера с кластером виртуализации
              type: string
          required:
            - reservation_rate
            - az_used
            - ntp_server
            - tls_version
            - anonymous_api_connect
            - https_api_connect
            - pv

  seaf.ta.components.k8s_deployment_dzo:
    title: K8s Deployment
    objects:
      k8s_deployment:
        route: "/"
        title: K8s Deployment
    schema: # JSON Schema контролирующая описание объекта сущности
      type: object
      patternProperties:
        "[a-zA-Z0-9_\\.]*":
          type: object
          $ref: "#/$defs/seaf.ta.components.base.entity"
          properties:
            deployment_id:
              title: K8s Deployment ID
              type: string
            name:
              title: Имя компонента
              type: string
            update_strategy:
              title: Стратегия обновления
              type: string
              enum: [RollingUpdate, Recreate]
            replicas:
              title: Количество реплик
              type: integer
            maxunavailable:
              title: Какое минимальное количество экземпляров должно работать во время обновления обслуживающих текущие запросы
              type: integer
            kubernetes_id:
              title: Kubernetes cluster ID
              type: array
              items:
                $ref: "#/$rels/seaf.ta.services.k8s.k8s"
            description:
              title: Описание использования
              type: string
            availabilityzone_id:
              title: В какие зоны доступности входит DC
              $ref: "#/$rels/seaf.ta.services.dc_az.dc_az"
          required:
            - deployment_id
            - name
            - update_strategy
            - replicas
            - maxunavailable
            - kubernetes_id
            - description
            - availabilityzone_id

  seaf.ta.components.k8s_pod_dzo:
    title: POD K8s
    objects:
      k8s_pod:
        route: "/"
        title: K8s pod
    schema: # JSON Schema контролирующая описание объекта сущности
      type: object
      patternProperties:
        "[a-zA-Z0-9_\\.]*":
          type: object
          $ref: "#/$defs/seaf.ta.components.base.entity"
          properties:
            pod_k8s_id:
              title: POD K8s ID
              type: string
            name:
              title: Имя POD
              type: string
            priorityclass:
              title: priorityClass
              type: integer
            update_strategy:
              title: Стратегия обновления
              type: string
              enum: [ RollingUpdate, Recreate ]
            stoptimeout:
              title: Период остановки POD в секундах
              type: integer
            pv:
              title: Используется PV/PVC
              type: boolean
            access_level:
              title: Требуемый уровень доступа
              type: string
              enum: [ Привилегированный, Не привилегированный ]
            secrets:
              title: Механизм хранения секретов
              type: string
            replicas:
              title: Количество реплик
              type: integer
            scheduled:
              title: Периодически запускаемый
              type: boolean
            tmp_storage:
              title: Размер временного хранилища, Mб
              type: integer
            ml:
              title: Используется для машинного обучения
              type: boolean
            kubernetes_id:
              title: Kubernetes cluster ID
              type: array
              items:
                $ref: "#/$rels/seaf.ta.services.k8s.k8s"
            deployment_id:
              title: В каких деплойментах задействован
              type: array
              items:
                $ref: "#/$rels/seaf.ta.components.k8s_deployment.k8s_deployment"
          required:
            - pod_k8s_id
            - name
            - update_strategy
            - stoptimeout
            - pv
            - ml
            - tmp_storage
            - scheduled
            - replicas
            - secrets
            - access_level
            - kubernetes_id

  seaf.ta.components.k8s_container_dzo:
    title: K8s Container
    objects:
      k8s_container:
        route: "/"
        title: K8s контейнер
    schema: # JSON Schema контролирующая описание объекта сущности
      type: object
      patternProperties:
        "[a-zA-Z0-9_\\.]*":
          type: object
          $ref: "#/$defs/seaf.ta.components.base.entity"
          properties:
            container_id:
              title: Container K8s ID
              type: string
            name:
              title: Имя контейнера
              type: string
            container_type:
              title: Тип контейнера
              type: string
              enum: [ Контейнер с бизнес-логикой, Контейнер-сайдкар]
            emergency_stop:
              title: Обработка аварийного прерывания
              type: string
              enum: [ Не задано, Уровень настройки среды исполнения, Уровень программного кода приложения]
            livenessprobepath:
              title: Путь к liveness probe
              type: string
            livenessprobeport:
              title: Порт liveness probe
              type: integer
            readinessprobepath:
              title: Путь к readiness probe
              type: string
            readinessprobeport:
              title: Порт readiness probe
              type: integer
            startupprobepath:
              title: Путь к startup probe
              type: string
            startupprobeport:
              title: Порт startup probe
              type: integer
            affinity:
              title: Affinity
              type: string
            nodeselector:
              title: nodeSelector
              type: string
            livenessprobe_count_restart:
              title: Количество неуспешных проб до перезагрузки
              type: integer
            livenessprobe_count_disable:
              title: Количество неуспешных проб до вывода из балансировки
              type: integer
            container_ram:
              title: Размер памяти, Мб
              type: integer
            container_cpu:
              title: Размер CPU, millicore
              type: integer
            pod_k8s_id:
              title: В каких подах задействован
              type: array
              items:
                $ref: "#/$rels/seaf.ta.components.k8s_pod.k8s_pod"
            server_id:
              title: Список серверов на которых запущен контейнер
              type: array
              items:
                $ref: "#/$rels/seaf.ta.components.server.server"
          required:
            - container_id
            - name

  seaf.ta.components.k8s_image_dzo:
    title: Image ПО для развёртывания в K8s
    objects:
      k8s_image:
        route: "/"
        title: Image ПО для развёртывания в K8s
    schema: # JSON Schema контролирующая описание объекта сущности
      type: object
      patternProperties:
        "[a-zA-Z0-9_\\.]*":
          type: object
          $ref: "#/$defs/seaf.ta.components.base.entity"
          properties:
            image_id:
              title: Image K8s ID
              type: string
            name:
              title: Имя образа
              type: string
            repo_path:
              title: Используемый репозиторий
              type: string
            repo_proved:
              title: Репозиторий утвержден ДБ
              type: boolean
            image_size:
              title: Размер образа, Мб
              type: integer
            description:
              title: Описание использования
              type: string
            container_id:
              title: В каких контейнерах задействован
              type: array
              items:
                $ref: "#/$rels/seaf.ta.components.k8s_container.k8s_container"
          required:
            - image_id
            - name
            - repo_path
            - repo_proved
            - image_size
            - description

  seaf.ta.components.server_metal_dzo:
    title: Расширение описания физических серверов для целей проверки станадртов
    objects:
      server_metal_dzo:
        route: "/"
        title: Расширение описание физического сервера для целей проверки станадртов
    schema: # JSON Schema контролирующая описание объекта сущности
      type: object
      patternProperties:
        "[a-zA-Z0-9_\\.]*":
          $ref: "#/$defs/seaf.ta.components.server"
          properties:
            #Часть 3. TACIR_1-Ч03.02.4-02.
            power_module_qty:
              title: Количество блоков питания
              type: integer
            #Часть 3. TACIR_1-Ч03.02.4-02.
            fan_qty:
              title: Количество кулеров
              type: integer
            #Часть 3. TACIR_1-Ч03.02.4-02.
            raid_level:
              title: Уровени RAID применённые на сервере
              type: array
            #Часть 3. TACIR_1-Ч03.02.5-02.
            raid_spare_disks:
              title: Количество запасных дисков для RAID массивов
              type: integer
            #Часть 3. TACIR_1-Ч03.02.6-02.
            rack_mount:
              title: Стоечное исполнение сервера
              type: boolean
          required:
            - power_module_qty
            - fan_qty
            - raid_level
            - raid_spare_disks
            - rack_mount

  seaf.ta.components.hw_storage_dzo:
    title: Расширение описания физической СХД для целей проверки станадртов
    objects:
      hw_storage_dzo:
        route: "/"
        title: Расширение описания физической СХД для целей проверки станадртов
    schema: # JSON Schema контролирующая описание объекта сущности
      type: object
      patternProperties:
        "[a-zA-Z0-9_\\.]*":
          $ref: "#/$defs/seaf.ta.components.hw_storage"
          properties:
            #Часть 4. TACIR_2-Ч04.01.3-01.
            nvram_amount:
              title: Объям NVRAM, Gb
              type: integer
            #Часть 4. TACIR_2-Ч04.01.4-01
            dedup_rate:
              title: Коэффициент дедупликации
              type: integer
            #Часть 4. TACIR_2-Ч04.01.4-01
            compression_rate:
              title: Коэффициент компрессии
              type: integer
            #Часть 4. TACIR_2-Ч04.01.5-01
            ssd_cache_qty:
              title: Количество SSD дисков для кеша
              type: integer
            #Часть 4. TACIR_2-Ч04.01.6-01
            ntp_server:
              title: Адрес NTP сервера с которым синхронизируется СХД
              type: string
            #Часть 4. TACIR_2-Ч04.01.7-01
            storage_console:
              title: Адрес консоли управления СХД
              type: string
            #Часть 4. TACIR_2-Ч04.01.11-02
            snapshot_lic:
              title: Наличие лицензии snapshot\snapclone
              type: boolean
            #Часть 4. TACIR_2-Ч04.01.12.1-03
            storage_controller_qty:
              title: Количество контроллеров СХД
              type: integer
            #Часть 4. TACIR_2-Ч04.01.12.1-03
            storage_spare_disk_qty:
              title: Количество запасных дисков в СХД
              type: integer
            #Часть 4. TACIR_2-Ч04.01.12.1-03
            pwr_supply_qty:
              title: Количество блоков питания
              type: integer
            #Часть 4. TACIR_2-Ч04.01.12.2-03
            links_qty:
              title: Количество SAN\LAN подключений для каждого контроллера
              type: integer
            #Часть 4. TACIR_2-Ч04.01.15-02
            reservation_ratio:
              title: % резервирования объёма в другом ЦОДе
              type: integer
            erasure_coding:
              title: Параметр чётности
              type: integer
          required:
            - nvram_amount
            - dedup_rate
            - compression_rate
            - ssd_cache_qty
            - ntp_server
            - storage_console
            - snapshot_lic
            - storage_controller_qty
            - storage_spare_disk_qty
            - pwr_supply_qty
            - links_qty
            - reservation_ratio
            - erasure_coding

  seaf.ta.services.monitoring_dzo:
    title: Расширение описания сервиса мониторинга для целей проверки станадртов
    objects:
      monitoring_dzo:
        route: "/"
        title: Расширение описания сервиса мониторинга для целей проверки станадртов
    schema: # JSON Schema контролирующая описание объекта сущности
      type: object
      patternProperties:
        "[a-zA-Z0-9_\\.]*":
          $ref: "#/$defs/seaf.ta.services.monitoring"
          properties:
            #Часть 6. TACMN_1-Ч06.01.4-02.
            monitoring_console:
              title: Адрес веб-консоли системы мониторинга
              type: string
            #Часть 6. TACMN_1-Ч06.01.7-02.
            cluster_id:
              title: ID кластера мониторинга
              type: string
            #Часть 6. TACMN_1-Ч06.01.5-02.
            alarm_transport:
              title: Перечисление транспортов для доставки уведомлений системы мониторинга (почта, телеграм, смс и т.д.)
              type: array
            #Часть 6. TACMN_1-Ч06.01.13-02.
            sber_radar:
              title: Адрес дашборда СберРадара
              type: string
            #Часть 6. TACMN_1-Ч06.01.13-02 и ещё 3 номера
            history:   #todo добавить проверку. Если history менее 1 года для инфра, 45 для журналирования, 1 месяц для прикладного, 7 дней для трейсинга, то несоответствие
              title: Длительность хранения метрик в днях
              type: integer
            #Часть 6. TACMN_1-Ч06.02.6-01 и ещё 1 номер
            frequency:   #todo добавить проверку. Если frequency более 60 секунд для инфра, 60 секунд  для прикладного, то несоответствие
              title: Частота сбора метрик в секундах
              type: integer
            #Часть 6. TACMN_1-Ч06.05.1-01
            pam_anabled:
              title: Система мониторинга подключена к PAM (priveled access management) системе
              type: boolean
            #Часть 6. TACMN_1-Ч06.05.3-01
            siem_anabled:
              title: Система мониторинга подключена к SIEM системе
              type: boolean
          required:
            - monitoring_console
            - cluster_id
            - alarm_transport
            - sber_radar
            - history
            - frequency
            - pam_anabled
            - siem_anabled

  seaf.ta.components.network_dzo:
    title: Расширение описания сетевых устройств для целей проверки станадртов
    objects:
      network_dzo:
        route: "/"
        title: Расширение описания сетевых устройств для целей проверки станадртов
    schema: # JSON Schema контролирующая описание объекта сущности
      type: object
      patternProperties:
        "[a-zA-Z0-9_\\.]*":
          $ref: "#/$defs/seaf.ta.components.network"
          properties:
            auth_type:
              title: Тип аутентификации
              type: string
              enum: [Отсутствует, Пароль и логин, Сертификат, Двухфакторная]
          required:
            - auth_type